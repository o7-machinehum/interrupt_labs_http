<head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="This is the fourth installment about designing a WiFi router into a phone charger for security, pentesting and red teaming. You can find all other pos"><meta name="author" content="Ryan Walker"><meta property="og:title" content="I&#39;m not putting a WiFi router into a phone charger (Part 3)"><meta property="og:description" content="This is the fourth installment about designing a WiFi router into a phone charger for security, pentesting and red teaming. You can find all other pos"><meta property="og:site_name" content="Interrupt Labs Blog"><meta property="og:type" content="article"><meta property="og:image" content="https://interruptlabs.caimg/home-bg.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://interruptlabs.caimg/home-bg.jpg"><title>I&#39;m not putting a WiFi router into a phone charger (Part 3) - Interrupt Labs Blog</title><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=G-JPDQ8MSX3T"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JPDQ8MSX3T")</script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Interrupt Labs Blog" type="application/atom+xml">
</head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"><a class="navbar-brand" href="/">Interrupt Labs Homepage</a></div></div></nav><header class="intro-header" style="background-image:url(/img/home-bg.jpg)"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><h1>I'm not putting a WiFi router into a phone charger (Part 3)</h1><span class="meta">2021-09-22</span></div></div></div></div></header><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><p>This is the fourth installment about designing a WiFi router into a phone charger for security, pentesting and red teaming. You can find all other posts on the main page.</p><p>There are two classes of problems in the world: stupid and interesting. Building a fusion reactor is an interesting problem, while a thorn in your finger is a stupid problem. Typically you don’t like working on stupid problems. You want them gone. A job dealing with primarily stupid problems may be considered a shitty job. Currently, I’m working on some really stupid problems. Let’s read an email from my friend Mia.</p><blockquote><p>As you know, the Texas IC components are tight supply, most components are out of stock, just some agents in market have limited inventory, but these agents seized this change to increase the cost maliciously, some IC components even increased 1000 times, but still hot selling. This is really bad situation for both of us. Fortunatelly, this IC still has 3000pcs in stock, but frankly speaking, cost is a little expensive, the unit price is 49.7usd&#x2F;pcs based on EXW, and the quotation is valid for 3 days.</p></blockquote><p>Mia is an electronics broker from Shenzhen; she hustles around components and connects engineers in North America to electronics dealers in Shenzhen. She is also trying to sell me a TI PMIC available on Digikey (3 months ago for $1.2) for $50. I’m using 4x of these PMICs on my board. You now see my problems; we are in a severe chip shortage.</p><h3 id="Sourcing-Electronics"><a href="#Sourcing-Electronics" class="headerlink" title="Sourcing Electronics"></a>Sourcing Electronics</h3><p>Sourcing components for prototyping is usually straightforward; your CAD software will generate you a CSV BOM, you upload it to Digikey, and parts show up at your front door. I’ve gone through Mouser, Digikey, LCSC, Aliexpress, and my friend Mia to get parts for this build. You arrive at a costly prototype when you add up the combined shipping costs, parts costs, and duties.<br><img src="https://cdn-images-1.medium.com/max/1024/1*yPWuqyUht7UZUgRTSs-bPA.png"></p><figcaption>Graphical Guide to Sourcing Electronics</figcaption><p></p><p>That’s enough complaining about the shortage; let’s talk about the power board design.</p><h3 id="Power-Board-Design"><a href="#Power-Board-Design" class="headerlink" title="Power Board Design"></a>Power Board Design</h3><p><img src="https://cdn-images-1.medium.com/max/708/0*a8Z9AtYRRrrUSmeu"></p><figcaption>Boards with no components</figcaption><p></p><p>There are two boards in the design, they stack on top of each other, and both serve two separate functions. The compute board contains the SOC, RAM, SD card, USB and 2x wifi radios. The power board converts (100–300VAC) to 1.1V, 1.35V, 2.5V, 3.0V, 3.3V and 5VDC. It uses a flyback power module to do the mains to 5V conversion.<br><img src="https://cdn-images-1.medium.com/max/1024/1*_sQUV1u1D7oWjY0G-CvM-w.png"></p><figcaption>Flyback Design</figcaption><p></p><p>CUI has developed a nice part to do the heavy lifting; the PBO-5C-5 is a 5W AC to DC converter mounted in a SIP package. It can take anywhere from 80–300VAC and will output 5VDC. I chose this device for its UL certification. When designing a mains powered device, safety is always top of mind; a poorly designed device can catch fire. The CUI part comes with an integrated transformer, so I can sleep well knowing it has proper high&#x2F;low side isolation.</p><h4 id="Transformer-Isolation"><a href="#Transformer-Isolation" class="headerlink" title="Transformer Isolation"></a>Transformer Isolation</h4><p><img src="https://cdn-images-1.medium.com/max/800/0*SlDlMt4wHoQyObXr.png"></p><figcaption>Half decent looking transformer</figcaption><p></p><p>The device above is an example of a transformer with decent looking isolation. The yellow tape isolates the primary windings from the secondary windings. Poorly manufactured transformers will often omit this tape and have only the bronze-coloured lacquer wire coating as isolation. If the device overheats, this can cause a primary to secondary short, which would connect AC mains to the 5V USB port; at best, this would destroy a phone; at worst, it could be lethal.</p><h4 id="PCB-Isolation"><a href="#PCB-Isolation" class="headerlink" title="PCB Isolation"></a>PCB Isolation</h4><p>The transformer isn’t the only item requiring decent isolation; the PCB should also be designed to allow acceptable creepage and clearance.</p><ol><li>Clearance is the shortest distance in air between two conductive parts.</li><li>Creepage distance is the shortest distance along the surface of solid insulating material between two conductive parts.</li></ol><p>You can google around and find a table of these recommended distances; I used IPC2221A. There are lots of different tables, most of which are similar.<br><img src="https://cdn-images-1.medium.com/max/666/0*ugUpcCH7n1HEg7ib.png"></p><figcaption>IPC2221A</figcaption><p></p><p>I just took 2.5mm and added another 1.5mm to be safe. 4 mm of isolation is very fair.<br><img src="https://cdn-images-1.medium.com/max/1024/1*fOu_Ny8UZW0jSxwChc-9MQ.png"></p><figcaption>High side to low side isolation</figcaption><p></p><h4 id="Line-Bypass-Capacitor"><a href="#Line-Bypass-Capacitor" class="headerlink" title="Line Bypass Capacitor"></a>Line Bypass Capacitor</h4><p>As for other safety components, let’s talk about some key players.<br><img src="https://cdn-images-1.medium.com/max/743/1*L_UX_CKZ20oDs9sDwD_6fw.png"></p><figcaption>CY3</figcaption><p></p><p>CY3 connects from the high to the low side. It exists to reduce electromagnetic interference. If it shorts out, it will connect AC mains to the 5V USB port. This is why we use class “Y1” rated capacitors, which will “fail open”.</p><h4 id="Fusing"><a href="#Fusing" class="headerlink" title="Fusing"></a>Fusing</h4><p><img src="https://cdn-images-1.medium.com/max/245/1*yGo_2FghuDP2pN4dBRb73A.png"></p><figcaption>Fuse F1</figcaption><p></p><p>The fuse on the input ensures that if anything downstream fails, you’re not relying on the wall breaker (15A in North America) to trip out. It’s possible the device might short against a load that won’t cause to breaker to trip but will cause several amps of current to flow, which will start a fire.</p><p><strong>NTC</strong><br><img src="https://cdn-images-1.medium.com/max/157/1*w8YQ_W0fVSBcwZWhTFMiUA.png"></p><figcaption>NTC1</figcaption><p></p><p>The negative temperature coefficient (NTC) device on the input limits inrush currents; when the device is powered up, NTC1 will have around 10ohms of resistance, raising the entire device’s input impedance, therefore limiting the device inrush current. After some time, the NTC1 will heat up, and the resistance will go down, reaching some equilibrium.</p><p><strong>TVS Diode</strong><br><img src="https://cdn-images-1.medium.com/max/117/1*8A_4ZcAXv1ZkEOGmBg1hAg.png"></p><figcaption>D1</figcaption><p></p><p>TVS diodes operate as transient overvoltage protection devices and are useful in highly inductive applications or devices that may experience static buildup during a plugin event. The diode has a reverse breakdown at a certain voltage, much like a zener, where it will start conducting.</p><h3 id="In-Conclusion"><a href="#In-Conclusion" class="headerlink" title="In Conclusion"></a>In Conclusion</h3><p>This certainly wasn’t my ideal post, but things are rocky right now. I plan to build some costly prototypes in the coming months, test and wait until things shake out on the chip shortage front.</p><p>I’m still very keen to run a crowdfunding campaign! However, I’ll have to press pause on that for now. Please keep in touch by joining our <a target="_blank" rel="noopener" href="https://discord.gg/EtZT7mjNuM">Discord community</a>!</p></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"></div></div></div></article>